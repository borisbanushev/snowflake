-- ============================================
-- MySQL Digital Banking Database Initialization
-- ============================================

USE digital_banking;

CREATE TABLE DIGITAL_CUSTOMER_PROFILE (
    DIGITAL_ID VARCHAR(36) PRIMARY KEY,
    CUSTOMER_ID VARCHAR(20),
    EMAIL VARCHAR(100),
    MOBILE_NUMBER VARCHAR(20),
    USERNAME VARCHAR(50) UNIQUE,
    REGISTRATION_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    LAST_LOGIN TIMESTAMP,
    LOGIN_COUNT INT DEFAULT 0,
    FAILED_LOGIN_COUNT INT DEFAULT 0,
    MFA_ENABLED BOOLEAN DEFAULT FALSE,
    MFA_TYPE VARCHAR(20),
    DEVICE_COUNT INT DEFAULT 0,
    PRIMARY_DEVICE_TYPE VARCHAR(20),
    BIOMETRIC_ENABLED BOOLEAN DEFAULT FALSE,
    PUSH_NOTIFICATIONS BOOLEAN DEFAULT TRUE,
    EMAIL_VERIFIED BOOLEAN DEFAULT FALSE,
    MOBILE_VERIFIED BOOLEAN DEFAULT FALSE,
    EKYC_STATUS VARCHAR(20) DEFAULT 'PENDING',
    EKYC_DATE TIMESTAMP NULL,
    PREFERRED_LANGUAGE VARCHAR(10) DEFAULT 'EN',
    TIMEZONE VARCHAR(50) DEFAULT 'Asia/Singapore',
    CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    MODIFIED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX IDX_CUSTOMER (CUSTOMER_ID),
    INDEX IDX_EMAIL (EMAIL)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE DIGITAL_SESSION (
    SESSION_ID VARCHAR(36) PRIMARY KEY,
    DIGITAL_ID VARCHAR(36),
    CUSTOMER_ID VARCHAR(20),
    SESSION_START TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    SESSION_END TIMESTAMP NULL,
    DURATION_SECONDS INT,
    DEVICE_ID VARCHAR(100),
    DEVICE_TYPE VARCHAR(20),
    DEVICE_MODEL VARCHAR(50),
    OS_VERSION VARCHAR(20),
    APP_VERSION VARCHAR(20),
    IP_ADDRESS VARCHAR(45),
    GEOLOCATION_LAT DECIMAL(10,7),
    GEOLOCATION_LON DECIMAL(10,7),
    CITY VARCHAR(100),
    COUNTRY VARCHAR(3),
    PAGES_VIEWED INT DEFAULT 0,
    TRANSACTIONS_INITIATED INT DEFAULT 0,
    TRANSACTIONS_COMPLETED INT DEFAULT 0,
    ERROR_COUNT INT DEFAULT 0,
    SESSION_QUALITY_SCORE DECIMAL(5,2),
    EXIT_REASON VARCHAR(30),
    CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX IDX_DIGITAL (DIGITAL_ID),
    INDEX IDX_CUSTOMER (CUSTOMER_ID),
    INDEX IDX_SESSION_START (SESSION_START),
    FOREIGN KEY (DIGITAL_ID) REFERENCES DIGITAL_CUSTOMER_PROFILE(DIGITAL_ID)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE DIGITAL_EVENT (
    EVENT_ID VARCHAR(36) PRIMARY KEY,
    SESSION_ID VARCHAR(36),
    DIGITAL_ID VARCHAR(36),
    CUSTOMER_ID VARCHAR(20),
    EVENT_TYPE VARCHAR(50),
    EVENT_NAME VARCHAR(100),
    EVENT_TIMESTAMP TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PAGE_NAME VARCHAR(100),
    ELEMENT_ID VARCHAR(100),
    EVENT_DATA TEXT,
    RESPONSE_TIME_MS INT,
    SUCCESS BOOLEAN DEFAULT TRUE,
    ERROR_CODE VARCHAR(20),
    ERROR_MESSAGE VARCHAR(500),
    CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX IDX_SESSION (SESSION_ID),
    INDEX IDX_EVENT_TYPE (EVENT_TYPE),
    INDEX IDX_TIMESTAMP (EVENT_TIMESTAMP),
    FOREIGN KEY (SESSION_ID) REFERENCES DIGITAL_SESSION(SESSION_ID)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE DIGITAL_KYC_DOCUMENT (
    DOCUMENT_ID VARCHAR(36) PRIMARY KEY,
    DIGITAL_ID VARCHAR(36),
    CUSTOMER_ID VARCHAR(20),
    DOCUMENT_TYPE VARCHAR(30),
    DOCUMENT_NUMBER VARCHAR(50),
    ISSUING_COUNTRY VARCHAR(3),
    ISSUE_DATE DATE,
    EXPIRY_DATE DATE,
    UPLOAD_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    VERIFICATION_STATUS VARCHAR(20) DEFAULT 'PENDING',
    VERIFICATION_DATE TIMESTAMP NULL,
    VERIFICATION_METHOD VARCHAR(30),
    CONFIDENCE_SCORE DECIMAL(5,2),
    REJECTION_REASON VARCHAR(200),
    FACE_MATCH_SCORE DECIMAL(5,2),
    LIVENESS_CHECK BOOLEAN,
    CREATED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    MODIFIED_DATE TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX IDX_DIGITAL (DIGITAL_ID),
    INDEX IDX_CUSTOMER (CUSTOMER_ID),
    INDEX IDX_STATUS (VERIFICATION_STATUS),
    FOREIGN KEY (DIGITAL_ID) REFERENCES DIGITAL_CUSTOMER_PROFILE(DIGITAL_ID)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
